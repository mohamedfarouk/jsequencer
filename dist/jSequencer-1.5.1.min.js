!function(a,b){"function"==typeof define&&define.amd?define(["exports"],function(c){a.JSequencer=b(a,c)}):"undefined"!=typeof exports?b(a,exports):a.JSequencer=b(a,{})}(this,function(a,b){function c(a,b,c){function d(b,c){var d=a[b].context,e=a[b].func,g=a[b].params;"function"==typeof g&&(g=g.call(d)),void 0===g&&(g=[]),g instanceof Array||(g=[g]),g.push(this),g.push(c),f.call(this,h,p);var i=e.apply(d,g);return i}function e(b,c){p=b;var g;try{g=d.call(this,p,c)}catch(h){r[p]=void 0,f.call(this,j,p,h,c,f)}if(q===n)r[p]=g,f.call(this,m,p,g);else{if(q===o)return;if(q!==k){if(r[p]=g,f.call(this,i,p,g),p>=a.length-1)return void f.call(this,m,p,g);p++,e.call(this,p,g)}}}function f(a){q=a,c.apply(this,arguments)}var p,q=g,r=[],s={};this.start=function(a){p=0,e.call(this,p,a)},this.pause=function(){if(q!==h)throw"cannot call pause unless state is "+h+" current state is "+q;f.call(this,k,p)},this.resume=function(b){if(q!==k&&q!==j)throw"cannot call resume unless state is "+k+"or "+j+" current state is "+q;return f.call(this,l,p),r[p]=b,c.call(this,i,p,b),p>=a.length-1?void f.call(this,m,p,b):(p++,void e.call(this,p,b))},this["break"]=function(a){if(q!==h&&q!==k)throw"cannot call pause unless state is "+h+" or "+k+" current state is "+q;f.call(this,n,p,a)},this.getCurrentStep=function(){return p},this.getResults=function(){var a=[];for(var b in r)a.push(r[b]);return a},this.set=function(a,b){s[a]=b},this.get=function(a){return s[a]},this.state=function(){return q}}function d(a,b,c){function d(a,b){return h===!1?a.call(this,b):void 0}function e(a,b,c){h===!1&&c&&(h=!0,a.call(this,b))}function f(a,b){h===!1&&(h=!0,a.call(this,b))}var g=!1,h=!1;b.add(d,a,[c]),this.then=function(c){if(g===!0)throw"final else already called, only endif function could be called";return b.add(e,a,[c]),this},this.elseif=function(c,f){if(g===!0)throw"final else already called, only endif function could be called";return b.add(d,a,[c]),b.add(e,a,[f]),this},this["else"]=function(c){return g=!0,b.add(f,a,[c]),this},this.endif=function(){return b}}function e(a,b,c,d){function e(a,b){return a.call(this,b)}function f(b,i,j){if(j){var k={context:a,params:[d],func:e},l={context:a,params:[h],func:f};g+=2,c.splice(g,0,k,l),b.call(this,i)}}var g=c.length,h=null;b.add(e,a,[d]),this["do"]=function(c){return h=c,b.add(f,a,[h]),b}}var f=a.JSequencer;b.VERSION="1.0.0",b.noConflict=function(){return a.JSequencer=f,this};var g=b.STAT_NOT_STARTED="NOT_STARTED",h=b.STAT_EXECUTING="EXECUTING",i=b.STAT_STEP_EXECUTED="STEP_EXECUTED",j=b.STAT_ERROR="ERROR",k=b.STAT_PAUSED="PAUSED",l=b.STAT_RESUMED="RESUMED",m=b.STAT_COMPLETED="COMPLETED",n=b.STAT_FAILED="BREAK",o=b.STAT_FAILED="FAILED";return b.Sequencer=function(a){function b(b,c){if(b===m&&"function"==typeof p&&p.call(q,this,arguments[2]),b===n)"function"==typeof r&&r.call(s,this,arguments[2]);else if(b===i)"function"==typeof g&&g.call(h,this,arguments[2]);else if(b===k)"function"==typeof x&&x.call(y,this);else if(b===o){if("function"==typeof v){var d={stepIndex:c,error:arguments[2],lastResult:arguments[3]};v.call(w,this,d)}}else if(b===j){var d={stepIndex:c,resume:a.resumeOnError,error:arguments[2],lastResult:arguments[3],newResult:void 0};if("function"==typeof t&&t.call(u,this,d),d.resume){var e=void 0===d.newResult?d.lastResult:d.newResult;this.resume(e)}else if("function"==typeof arguments[4]){var f=arguments[4];f.call(this,o,c,arguments[2],arguments[3])}}else b===l&&"function"==typeof z&&z.call(A,this)}var f=[];a=a||{};var g,h,p,q,r,s,t,u,v,w,x,y,z,A;(void 0===a.defaultContext||null===a.defaultContext)&&(a.defaultContext=this),(void 0===a.resumeOnError||null===a.resumeOnError)&&(a.resumeOnError=!1);var B=null;B=new c(f,a.resumeOnError,b),this.add=function(b,c,d){if("object"==typeof b&&arguments.length>1)throw"parameters can be either passed as single object or arguments, not both";return"object"==typeof b&&(c=b.context,d=b.params,b=b.func),(null===c||void 0===c)&&(c=a.defaultContext),(null===d||void 0===d)&&(d=[]),f.push({context:c,params:d,func:b}),this},this["if"]=function(a,b){return new d(b,this,a)},this["while"]=function(a,b){return new e(b,this,f,a)},this.onStep=function(b,c){return g=b,h=void 0===c||null===c?a.defaultContext:c,this},this.onCompleted=function(b,c){return p=b,q=void 0===c||null===c?a.defaultContext:c,this},this.onError=function(b,c){return t=b,u=void 0===c||null===c?a.defaultContext:c,this},this.onFailed=function(b,c){return v=b,w=void 0===c||null===c?a.defaultContext:c,this},this.onPaused=function(b,c){return x=b,y=void 0===c||null===c?a.defaultContext:c,this},this.onResumed=function(b,c){return z=b,A=void 0===c||null===c?a.defaultContext:c,this},this.onBreak=function(b,c){return r=b,s=void 0===c||null===c?a.defaultContext:c,this},this.context=function(){return B}},b});