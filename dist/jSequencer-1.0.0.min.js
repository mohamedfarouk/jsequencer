!function(a,b){"function"==typeof define&&define.amd?define(["exports"],function(c){a.JSequencer=b(a,c)}):"undefined"!=typeof exports?b(a,exports):a.JSequencer=b(a,{})}(this,function(a,b){function c(a,b,c){function d(b,c){var d=a[b].context,e=a[b].func,g=a[b].params;"function"==typeof g&&(g=g.call(d)),void 0===g&&(g=[]),g instanceof Array||(g=[g]),g.push(this),g.push(c),f.call(this,h,o);var i=e.apply(d,g);return i}function e(b,g){o=b;var h;try{h=d.call(this,o,g)}catch(l){q[o]=void 0,f.call(this,j,o,l,g)}if(p===n)q[o]=h,f.call(this,m,o,h);else if(p!==k){if(q[o]=h,c.call(this,i,h),o>=a.length-1)return void f.call(this,m,o,h);o++,e.call(this,o,h)}}function f(a){p=a,c.apply(this,arguments)}var o,p=g,q=[],r={};this.start=function(a){o=0,e.call(this,o,a)},this.pause=function(){if(p!==h)throw"cannot call pause unless state is "+h+" current state is "+p;f.call(this,k,o)},this.resume=function(b){if(p!==k&&p!==j)throw"cannot call resume unless state is "+k+"or "+j+" current state is "+p;return f.call(this,l,o),q[o]=b,c.call(this,i,o,b),o>=a.length-1?void f.call(this,m,o,b):(o++,void e.call(this,o,b))},this["break"]=function(a){if(p!==h&&p!==k)throw"cannot call pause unless state is "+h+" or "+k+" current state is "+p;f.call(this,n,o,a)},this.getCurrentStep=function(){return o},this.getResults=function(){var a=[];for(var b in q)a.push(q[b]);return a},this.set=function(a,b){r[a]=b},this.get=function(a){return r[a]},this.state=function(){return p}}function d(a,b,c){function d(a,b){return h===!1?a.call(this,b):void 0}function e(a,b,c){h===!1&&c&&(h=!0,a.call(this,b))}function f(a,b){h===!1&&(h=!0,a.call(this,b))}var g=!1,h=!1;b.add(d,a,[c]),this.then=function(c){if(g===!0)throw"final else already called, only endif function could be called";return b.add(e,a,[c]),this},this.elseif=function(c,f){if(g===!0)throw"final else already called, only endif function could be called";return b.add(d,a,[c]),b.add(e,a,[f]),this},this["else"]=function(c){return g=!0,b.add(f,a,[c]),this},this.endif=function(){return b}}function e(a,b,c,d){function e(a,b){return a.call(this,b)}function f(b,i,j){if(j){var k={context:a,params:[d],func:e},l={context:a,params:[h],func:f};g+=2,c.splice(g,0,k,l),b.call(this,i)}}var g=c.length,h=null;b.add(e,a,[d]),this["do"]=function(c){return h=c,b.add(f,a,[h]),b}}var f=a.JSequencer;b.VERSION="1.0.0",b.noConflict=function(){return a.JSequencer=f,this};var g=b.STAT_NOT_STARTED="NOT_STARTED",h=b.STAT_EXECUTING="EXECUTING",i=b.STAT_STEP_EXECUTED="STEP_EXECUTED",j=b.STAT_ERROR="ERROR",k=b.STAT_PAUSED="PAUSED",l=b.STAT_RESUMED="RESUMED",m=b.STAT_COMPLETED="COMPLETED",n=b.STAT_FAILED="BREAK",o=b.STAT_FAILED="FAILED";return b.Sequencer=function(a){function b(c,d){if(c===m&&"function"==typeof h&&h.call(p,this,arguments[2]),c===n)"function"==typeof q&&q.call(r,this,arguments[2]);else if(c===i)"function"==typeof f&&f.call(g,this);else if(c===k)"function"==typeof w&&w.call(x,this);else if(c===o){if("function"==typeof u){var e={stepIndex:d,error:arguments[2],lastResult:arguments[3]};u.call(v,this,e)}}else if(c===j){var e={stepIndex:d,resume:a.resumeOnError,error:arguments[2],lastResult:arguments[3],newResult:void 0};if("function"==typeof s&&s.call(t,this,e),e.resume){var A=void 0===e.newResult?e.lastResult:e.newResult;this.resume(A)}else b.call(this,o,d,arguments[2],arguments[3])}else c===l&&"function"==typeof y&&y.call(z,this)}var f,g,h,p,q,r,s,t,u,v,w,x,y,z,A=[];(void 0===a.defaultContext||null===a.defaultContext)&&(a.defaultContext=this),(void 0===a.resumeOnError||null===a.resumeOnError)&&(a.resumeOnError=!1);var B=null;B=new c(A,a.resumeOnError,b),this.add=function(b,c,d){if("object"==typeof b&&arguments.length>1)throw"parameters can be either passed as single object or arguments, not both";return"object"==typeof b&&(c=b.context,d=b.params,b=b.func),(null===c||void 0===c)&&(c=a.defaultContext),(null===d||void 0===d)&&(d=[]),A.push({context:c,params:d,func:b}),this},this["if"]=function(a,b){return new d(b,this,a)},this["while"]=function(a,b){return new e(b,this,A,a)},this.onStep=function(b,c){return f=b,g=void 0===c||null===c?a.defaultContext:c,this},this.onCompleted=function(b,c){return h=b,p=void 0===c||null===c?a.defaultContext:c,this},this.onError=function(b,c){return s=b,t=void 0===c||null===c?a.defaultContext:c,this},this.onFailed=function(b,c){return u=b,v=void 0===c||null===c?a.defaultContext:c,this},this.onPaused=function(b,c){return w=b,x=void 0===c||null===c?a.defaultContext:c,this},this.onResumed=function(b,c){return y=b,z=void 0===c||null===c?a.defaultContext:c,this},this.onBreak=function(b,c){return q=b,r=void 0===c||null===c?a.defaultContext:c,this},this.context=function(){return B}},b});