!function(a,b){"function"==typeof define&&define.amd?define(["exports"],function(c){a.JSequencer=b(a,c)}):"undefined"!=typeof exports?b(a,exports):a.JSequencer=b(a,{})}(this,function(a,b){function c(a,b,c){function d(b,c){var d=a[b].context,e=a[b].func,f=a[b].params;"function"==typeof f&&(f=f.call(d)),void 0===f&&(f=[]),f instanceof Array||(f=[f]),f.push(this),f.push(c),n.call(this,g,o);var h=e.apply(d,f);return h}function e(b,f){o=b;var g;try{g=d.call(this,o,f)}catch(k){q[o]=void 0,n.call(this,i,o,k,f)}if(p===m)q[o]=g,n.call(this,l,o,g);else if(p!==j){if(q[o]=g,c.call(this,h,g),o>=a.length-1)return void n.call(this,l,o,g);o++,e.call(this,o,g)}}function n(a){p=a,c.apply(this,arguments)}var o,p=f,q=[],r={};this.start=function(a){o=0,e.call(this,o,a)},this.pause=function(){if(p!==g)throw"cannot call pause unless state is "+g+" current state is "+p;n.call(this,j,o)},this.resume=function(b){if(p!==j&&p!==i)throw"cannot call resume unless state is "+j+"or "+i+" current state is "+p;return n.call(this,k,o),q[o]=b,c.call(this,h,o,b),o>=a.length-1?void n.call(this,l,o,b):(o++,void e.call(this,o,b))},this["break"]=function(a){if(p!==g&&p!==j)throw"cannot call pause unless state is "+g+" or "+j+" current state is "+p;n.call(this,m,o,a)},this.getCurrentStep=function(){return o},this.getResults=function(){var a=[];for(var b in q)a.push(q[b]);return a},this.set=function(a,b){r[a]=b},this.get=function(a){return r[a]},this.state=function(){return p}}function d(a,b,c){function d(){for(var a in i)if(i[a]===!0)return!0;return!1}function e(a,b){return d()===!1?a.call(this,b):void 0}function f(a,b,c){d()===!1&&(i.push(c),c&&a.call(this,b))}function g(a,b){d()===!1&&(i.push(!0),a.call(this,b))}var h=!1,i=[];b.add(e,a,[c]),this.then=function(c){if(h===!0)throw"final else already called, only endif function could be called";return b.add(f,a,[c]),this},this.elseif=function(c,d){if(h===!0)throw"final else already called, only endif function could be called";return b.add(e,a,[c]),b.add(f,a,[d]),this},this["else"]=function(c){return h=!0,b.add(g,a,[c]),this},this.endif=function(){return b}}var e=a.JSequencer;b.VERSION="1.0.0",b.noConflict=function(){return a.JSequencer=e,this};var f=b.STAT_NOT_STARTED="NOT_STARTED",g=b.STAT_EXECUTING="EXECUTING",h=b.STAT_STEP_EXECUTED="STEP_EXECUTED",i=b.STAT_ERROR="ERROR",j=b.STAT_PAUSED="PAUSED",k=b.STAT_RESUMED="RESUMED",l=b.STAT_COMPLETED="COMPLETED",m=b.STAT_FAILED="BREAK",n=b.STAT_FAILED="FAILED";return b.Sequencer=function(a){function b(c,d){if(c===l&&"function"==typeof g&&g.call(o,this,arguments[2]),c===m)"function"==typeof p&&p.call(q,this,arguments[2]);else if(c===h)"function"==typeof e&&e.call(f,this);else if(c===j)"function"==typeof v&&v.call(w,this);else if(c===n){if("function"==typeof t){var z={stepIndex:d,error:arguments[2],lastResult:arguments[3]};t.call(u,this,z)}}else if(c===i){var z={stepIndex:d,resume:a.resumeOnError,error:arguments[2],lastResult:arguments[3],newResult:void 0};if("function"==typeof r&&r.call(s,this,z),z.resume){var A=void 0===z.newResult?z.lastResult:z.newResult;this.resume(A)}else b.call(this,n,d,arguments[2],arguments[3])}else c===k&&"function"==typeof x&&x.call(y,this)}var e,f,g,o,p,q,r,s,t,u,v,w,x,y,z=[];(void 0===a.defaultContext||null===a.defaultContext)&&(a.defaultContext=this),(void 0===a.resumeOnError||null===a.resumeOnError)&&(a.resumeOnError=!1);var A=null;A=new c(z,a.resumeOnError,b),this.add=function(b,c,d){if("object"==typeof b&&arguments.length>1)throw"parameters can be either passed as single object or arguments, not both";return"object"==typeof b&&(c=b.context,d=b.params,b=b.func),(null===c||void 0===c)&&(c=a.defaultContext),(null===d||void 0===d)&&(d=[]),z.push({context:c,params:d,func:b}),this},this["if"]=function(a,b){return new d(b,this,a)},this.onStep=function(b,c){return e=b,f=void 0===c||null===c?a.defaultContext:c,this},this.onCompleted=function(b,c){return g=b,o=void 0===c||null===c?a.defaultContext:c,this},this.onError=function(b,c){return r=b,s=void 0===c||null===c?a.defaultContext:c,this},this.onFailed=function(b,c){return t=b,u=void 0===c||null===c?a.defaultContext:c,this},this.onPaused=function(b,c){return v=b,w=void 0===c||null===c?a.defaultContext:c,this},this.onResumed=function(b,c){return x=b,y=void 0===c||null===c?a.defaultContext:c,this},this.onBreak=function(b,c){return p=b,q=void 0===c||null===c?a.defaultContext:c,this},this.context=function(){return A}},b});